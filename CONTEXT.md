# Backend Context - Personal Trainer App

## 1. Technology Stack
- **Runtime**: Node.js
- **Framework**: Express.js
- **Language**: TypeScript
- **Database**: MongoDB (via Mongoose ODM)
- **Authentication**: JWT (JSON Web Tokens)

## 2. Project Architecture (`src/`)
The backend follows a layered MVC (Model-View-Controller) architecture, though "View" is replaced by JSON API responses.

### Key Directories
- **`models/`**: Mongoose Schemas & TypeScript Interfaces.
    - `User.ts`: Coach/Athlete definitions.
    - `Exercise.ts`: Library of exercises.
    - `WorkoutPlan.ts`: Routines assigned to athletes.
    - `WorkoutLog.ts`: Completed sessions for analytics.
- **`controllers/`**: Business logic. Handles requests and responses.
    - `authController.ts`: Login, Register, Code Generation.
    - `exerciseController.ts`: CRUD for exercises.
    - `workoutPlanController.ts`: Managing plans.
    - `workoutLogController.ts`: Logger logic.
- **`routes/`**: API Route definitions. Maps URLs to controllers and middleware.
- **`middleware/`**: Application middleware.
    - `authMiddleware.ts`: Verifies JWT tokens and checks User Roles.
- **`types/`**: Shared TypeScript type definitions.

## 3. API Structure
Base URL: `http://localhost:3000` (Local)

### Auth (`/auth`)
- `POST /register`: Registers Coach or Athlete (requires code).
- `POST /login`: Returns JWT.
- `POST /generate-code`: (Coach only) Generates access codes.

### Content
- `/exercises`: CRUD for Exercise library. Protected (Coach write access).
- `/workouts`: Managing Workout Plans.
- `/logs`: Logging performed sessions.

## 4. Key Concepts

### Authentication & Authorization
- **JWT**: Passed in `Authorization` header as `Bearer <token>`.
- **Roles**: `COACH` vs `ATHLETE`. Middleware `authorizeRole` enforces permissions.
- **Access Codes**: Athletes cannot register without a valid code generated by a Coach.

### Database Strategy (MongoDB)
- **Relationships**: References (ObjectId) are used between Schemas (e.g., `WorkoutPlan` references `User` (Athlete) and `User` (Coach)).
- **AI Readiness**: `WorkoutLog` schema is designed to store granular set data (RIR, Reps, Weight) for future LLM analysis.

## 5. Environment Variables (`.env`)
Required variables:
- `PORT`: Server port (default 3000).
- `MONGO_URI`: Connection string.
- `JWT_SECRET`: Secret for signing tokens.
